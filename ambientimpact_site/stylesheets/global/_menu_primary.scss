// -----------------------------------------------------------------------------
//   Primary site menu
// -----------------------------------------------------------------------------

///
/// Primary menu item font size when large font size breakpoint doesn't match.
///
$menu-primary-font-size-small:  100%;

///
/// Primary menu item font size when large font size breakpoint matches.
///
$menu-primary-font-size-large:  110%;

///
/// Primary menu background colour.
///
$menu-primary-background-colour: $ambientimpact-orange;

@include add-breakpoints((
  // At which height to start using $menu-primary-font-size-large.
  'menu-primary-font-size-large': get-breakpoint-value('height-small')
));

.region-primary-menu {
  ///
  /// The local stacking order of elements; later in the list is higher.
  ///
  $local-stacking-order: background, content;

  margin-top:     0;
  margin-bottom:  3em;

  @include horizontal-bleed-background(
    $colour:  $menu-primary-background-colour,
    $z-index: index($local-stacking-order, background),
    // Don't use the topmost shadow, as that would show on top of the site
    // title. See _header.scss for the topmost shadow.
    $shadow:  (false, true, true)
  );

  &.headroom {
    // Make sure we're sticky if Headroom is active, as the horizontal-
    // bleed-background overrides it.
    position: sticky;
  }

  .block > .menu {
    position:   relative;

    display:    flex;

    // Override base, as this cuts off the right side of the menu. D:
    max-width:  none;

    margin-top:     0;
    margin-bottom:  0;

    // See _menu_primary_item.scss for margin-left and margin-right.

    z-index:    index($local-stacking-order, content);

    // This allows the menu items to scroll horizontally when the menu has not
    // been enhanced with the overflow functionality or that fails to correctly
    // execute for any reason.
    overflow-x: auto;

    // When overflow is available, switch to visible so that the vertical
    // overflow is shown, which is not the case when the horizontal is clipped
    // because reasons.
    &--overflow-enhanced {
      overflow-x: visible;
    }

    // Space items evenly.
    // IMPORTANT: space-around causes some odd overflow hiding.
    justify-content: space-between;

    // When all items are in the overflow menu, centre-align the overflow
    // toggle, which is the only item visible in that case.
    &--all-overflow {
      justify-content: center;
    }

    font-size: $menu-primary-font-size-small;

    @include media('>=menu-primary-font-size-large') {
      font-size: $menu-primary-font-size-large;
    }
  }
}

// This is the primary menu region overlay that covers the page content and
// fades it out when the menu is open. It also prevents clicking/tapping
// activating any content (e.g. links or buttons), which is a UX convention on
// mobile. Once a single click or tap has occurred, any open drop-down menu will
// lose focus and immediately close, and content below the overlay will become
// clickable/tappable again.
.region-primary-menu-overlay {
  position: fixed;

  top:    0;
  bottom: 0;
  left:   0;
  right:  0;

  transition-duration:        0.2s;
  transition-property:        opacity;
  transition-timing-function: linear;

  // If pointer-events is not supported, outright hide the overlay. Transitions
  // won't work, but at least it won't block the page.
  visibility: hidden;

  @supports (pointer-events: none) {
    visibility:     visible;
    opacity:        0;
    pointer-events: none;
  }

  @include set-colours($background: $background-colour-light);

  @include on-dark-colour-scheme {
    @include set-colours($background: $background-colour-dark);
  }

  &--menu-is-open {
    visibility:     visible;
    opacity:        0.6;
    pointer-events: auto;
  }
}
